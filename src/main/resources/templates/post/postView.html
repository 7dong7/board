<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>게시글 상세</title>
    <link rel="stylesheet" href="/css/post/postView.css">
</head>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        document.querySelectorAll(".btn-reply").forEach(button => {

            button.addEventListener("click", function() {
                console.log(this.dataset.postId);
                console.log(this.dataset.parentId);

                let postId = this.dataset.postId;
                let parentId = this.dataset.parentId;

                this.parentElement.querySelector(".postId").value = postId;
                this.parentElement.querySelector(".parentId").value = parentId;

                console.log(this.parentElement.querySelector(".postId").value)
                console.log(this.parentElement.querySelector(".parentId").value)

            });

        }); // end of document.querySelectorAll(".btn-reply").forEach(button => {
    }); // end of document.addEventListener('DOMContentLoaded', () => {
</script>

<body>
<div class="container">
    <div class="header">
        <h1 class="board-title">게시글</h1>

    </div>
    <div class="post-info">
        <div class="post-title">
            <span class="post-category">[카테고리]</span> <!-- 아직 없음 -->
            <span th:text="${post.title}">게시글 제목</span>
            <span class='post-viewCount' th:text="'['+${post.viewCount}+']'">조회수</span>
        </div>
        <hr class="divider">
        <div class="post-meta">
            <span class="post-author" th:text="'작성자: ' + ${post.username}">작성자</span>
            <span class="post-date" th:text="'작성일: ' + ${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm:ss')}">작성일 2024-06-17 15:30</span>
        </div>
    </div>

    <div class="post-content">
        <p th:text="${post.content}">
            여기에 게시글 본문이 들어갑니다.
        </p>
    </div>
    <hr class="divider">

    <h2>댓글</h2>
    <div class="comments" >
        <ul class="comment-list">
            <!-- 댓글 -->
            <li th:each="comment : ${post.commentDtoPage}">
                <div class="comment-info">
                    <span class="comment-author" th:text="${comment.author}">작성자</span>
                    <span class="comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm:ss')}">작성일</span>
                </div>
                <div class="comment-content" th:text="${comment.content}"></div>

                <!-- 대댓글 -->
                <ul class="reply-list">
                    <li th:each="reply : ${comment.replies}">
                        <div class="reply-info">
                            <span class="reply-author" th:text="${reply.author}">작성자</span>
                            <span class="reply-date" th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm:ss')}">작성일</span>
                        </div>
                        <div class="reply-content" th:text="${reply.content}"></div>
                    </li>
                </ul>

                <!-- 대댓글 작성 폼 -->
                <div class="reply-form" id="reply-form-${comment.id}" style="display: block;">
                    <form th:action="@{/comments/replies/new}" method="post" th:object="${newComment}">
                        <textarea th:field="*{content}" rows="3" placeholder="댓글 내용을 입력하세요" required></textarea>
                        <button class="btn-reply" type="submit" th:attr="data-post-id=${post.postId}, data-parent-id=${comment.commentId}">등록</button>
                        <span>postId</span><input class="postId" th:field="*{postId}" /> <!-- 게시글 id-->
                        <span>commentId</span><input class="parentId" th:field="*{parentId}"/> <!-- 부모 댓글 id-->
                    </form>
                </div>
            </li>
        </ul>

        <!-- 작성된 댓글이 없는 경우-->
        <div class="no-comment" th:if="${post.commentDtoPage.content.isEmpty()}">작성된 댓글이 없습니다.</div>

        <!-- 댓글 작성 폼 -->
        <div class="comment-form">
            <h3>댓글 작성</h3>
            <form th:action="@{/comments/new}" th:object="${newComment}" method="post">
                <div class="form-group">
                    <textarea id="comment-content" th:field="*{content}" rows="3" required></textarea>
                </div>
                <input th:type="hidden" th:field="*{postId}" />
                <div class="form-group">
                    <button type="submit" class="submit-button">등록</button>
                </div>
            </form>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination" th:if="${post.commentDtoPage.totalPages > 0}">
            <!-- 처음 페이지 -->
            <a th:href="@{/posts/{id}(id=${post.postId}, page=1)}"
               th:if="${!post.commentDtoPage.first}">처음</a>

            <!-- 이전 페이지 -->
            <a th:href="@{/posts/{id}(id=${post.postId}, page=${post.commentDtoPage.number})}"
               th:if="${post.commentDtoPage.hasPrevious()}">이전</a>

            <!-- 페이지 번호 반복 출력 -->
            <div th:if="${post.commentDtoPage.totalPages > 0}">
                <span th:each="page : ${#numbers.sequence(1, post.commentDtoPage.totalPages)}"
                      th:if="${page >= post.commentDtoPage.number + 1 - 3 and page <= post.commentDtoPage.number + 1 + 3}">
                    <a th:href="@{/posts/{id}(id=${post.postId}, page=${page})}"
                       th:text="${page}"
                       th:classappend="${page == post.commentDtoPage.number + 1} ? 'active'">1</a>
                </span>
            </div>
            <!-- 다음 페이지 -->
            <a th:href="@{/posts/{id}(id=${post.postId}, page=${post.commentDtoPage.number + 2})}"
               th:if="${post.commentDtoPage.hasNext()}">다음</a>

            <!-- 마지막 페이지 -->
            <a th:href="@{/posts/{id}(id=${post.postId}, page=${post.commentDtoPage.totalPages})}"
               th:if="${!post.commentDtoPage.last}">마지막</a>
        </div>
    </div>

    <div class="tags">
        <span class="tag" data-id="1">Tag 1</span>
        <span class="tag" data-id="2">Tag 2</span>
        <span class="tag" data-id="3">Tag 3</span>
    </div>

    <div class="footer">
        <a href="/post" class="back-link">목록으로 돌아가기</a>
    </div>
</div>
</body>
</html>
